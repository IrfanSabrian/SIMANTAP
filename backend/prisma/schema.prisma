// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model JalanLingkunganKubuRaya {
  id          Int      @id @default(autoincrement())
  geom        String?  @db.Text // PostGIS geometry as text
  fid         Int?
  noRuas      String?  @map("no_ruas")
  noProv      Int?     @map("no_prov")
  noKab       Int?     @map("no_kab")
  noKec       Int?     @map("no_kec")
  noDesa      Int?     @map("no_desa")
  noJalan     String?  @map("no_jalan")
  nama        String?
  namaJalan   String?  @map("nama_jalan")
  panjangM    Float?   @map("panjang_m")
  lebarM      Float?   @map("lebar_m_")
  tahun       String?
  kondisi     String?
  nilai       Float?
  bobot       Int?
  keterangan  String?
  kecamatan   String?
  desa        String?
  utmXAwal    Float?   @map("utm_x_awal")
  utmYAwal    Float?   @map("utm_y_awal")
  pngnlAwal   String?  @map("pngnl_awal")
  utmXAkhi    Float?   @map("utm_x_akhi")
  utmYAkhi    Float?   @map("utm_y_akhi")
  pngnlAkhi   String?  @map("pngnl_akhi")
  shapeLeng   Float?   @map("shape_leng")
  shapeLe1    Float?   @map("shape_le_1")
  shapeLe2    Float?   @map("shape_le_2")
  shapeLe3    Float?   @map("shape_le_3")
  shapeLe4    Float?   @map("shape_le_4")
  shapeLe5    Float?   @map("shape_le_5")

  @@map("jalan_lingkungan_kubu_raya")
}

model Aduan {
  id          BigInt   @id @default(autoincrement())
  nomorRuas   String   @map("nomor_ruas")
  namaPelapor String?  @map("nama_pelapor")
  anonim      Boolean  @default(false)
  description String?
  email       String?
  status      String   @default("diajukan")
  photos      String[] @default([])
  createdAt   DateTime @map("created_at") @default(now())
  updatedAt   DateTime @map("updated_at") @updatedAt

  @@index([nomorRuas], map: "idx_aduan_nomor_ruas")
  @@index([createdAt], map: "idx_aduan_created_at")
  @@index([status], map: "idx_aduan_status")
  @@index([photos], map: "idx_aduan_photos", type: Gin)
  @@map("aduan")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String?  @unique @db.VarChar(255)
  username  String   @unique @db.VarChar(100)
  password  String   @db.VarChar(255)
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@index([username])
  @@index([role])
}

enum Role {
  ADMIN
  USER
}

enum JenisInfrastruktur {
  Jalan_Lingkungan          @map("Jalan Lingkungan")
  Jembatan_Lingkungan       @map("Jembatan Lingkungan")
  Drainase_Lingkungan      @map("Drainase Lingkungan")
  Kawasan_Permukiman        @map("Kawasan Permukiman")
  Rumah_Tidak_Layak_Huni    @map("Rumah Tidak Layak Huni")
}

// ============================================
// BERITA (News)
// ============================================

model Berita {
  id               Int       @id @default(autoincrement())
  judul            String    @db.VarChar(255)
  slug             String    @unique @db.VarChar(255)
  ringkasan        String?   @db.Text
  konten           String    @db.Text
  thumbnail        String?   @db.VarChar(500)
  kategori         String?   @db.VarChar(100)
  penulis          String?   @default("Admin") @db.VarChar(100)
  waktuBaca        String?   @map("waktu_baca") @db.VarChar(20)
  status           String    @default("published") @db.VarChar(20)
  tanggalPublikasi DateTime? @map("tanggal_publikasi")
  dibuatPada       DateTime  @default(now()) @map("dibuat_pada")
  diperbaruiPada   DateTime  @updatedAt @map("diperbarui_pada")

  @@index([slug])
  @@index([status])
  @@index([kategori])
  @@index([tanggalPublikasi])
  @@map("berita")
}

// ============================================
// DOKUMENTASI KEGIATAN
// ============================================

model DokumentasiKegiatan {
  id             Int      @id @default(autoincrement())
  judul          String   @db.VarChar(255)
  slug           String   @unique @db.VarChar(255)
  deskripsi      String?  @db.Text
  konten         String?  @db.Text
  kategori       String?  @db.VarChar(100)
  tanggal        DateTime @db.Date
  thumbnail      String?  @db.VarChar(500)
  gambarLainnya  String[] @default([]) @map("gambar_lainnya")
  dibuatPada     DateTime @default(now()) @map("dibuat_pada")
  diperbaruiPada DateTime @updatedAt @map("diperbarui_pada")

  @@index([slug])
  @@index([tanggal])
  @@index([kategori])
  @@map("dokumentasi_kegiatan")
}

// ============================================
// DOKUMENTASI INFRASTRUKTUR
// ============================================

model DokumentasiInfrastruktur {
  id                  Int                          @id @default(autoincrement())
  jenisInfrastruktur  JenisInfrastruktur           @map("jenis_infrastruktur")
  linkYoutube         String                       @map("link_youtube") @db.VarChar(500)
  noRuas              String                       @map("no_ruas") @db.VarChar(100)
  dibuatPada          DateTime                     @default(now()) @map("dibuat_pada")
  diperbaruiPada      DateTime                     @updatedAt @map("diperbarui_pada")

  @@index([jenisInfrastruktur])
  @@index([noRuas])
  @@map("dokumentasi_infrastruktur")
}

// ============================================
// DOKUMEN PPID (Informasi Publik)
// ============================================

model DokumenPpid {
  id               Int       @id @default(autoincrement())
  judul            String    @db.VarChar(255)
  slug             String    @unique @db.VarChar(255)
  deskripsi        String?   @db.Text
  kategori         String?   @db.VarChar(100)
  urlFile          String    @map("url_file") @db.VarChar(500)
  namaFile         String    @map("nama_file") @db.VarChar(255)
  tahun            String?   @db.VarChar(4)
  nomorDokumen     String?   @map("nomor_dokumen") @db.VarChar(100)
  jumlahUnduhan    Int       @default(0) @map("jumlah_unduhan")
  status           String    @default("published") @db.VarChar(20)
  tanggalPublikasi DateTime? @map("tanggal_publikasi")
  dibuatPada       DateTime  @default(now()) @map("dibuat_pada")
  diperbaruiPada   DateTime  @updatedAt @map("diperbarui_pada")

  @@index([slug])
  @@index([kategori])
  @@index([status])
  @@index([tahun])
  @@map("dokumen_ppid")
}